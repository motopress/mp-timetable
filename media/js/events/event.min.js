Registry.register("Event",function(t){"use strict";function e(){return{event_id:"",eventsData:{},init:function(){n.initTimePicker(),n.addEventButton(),n.initDeleteButtons(),n.initEditButtons(),n.initColorPicker(),n.initDatePicker(),n.columnRadioBox()},initTimePicker:function(){var e=Boolean(parseInt(t("#time_format").val()));t("#event_start").timepicker({showPeriod:e,showPeriodLabels:e,defaultTime:"00:00"}),t("#event_end").timepicker({showPeriod:e,showPeriodLabels:e,defaultTime:"00:00"})},initSlider:function(e,i){var o=_.isUndefined(i)?!1:Boolean(i),r=e.replace(/^\D+/g,"");t(e).carouFredSel({items:{visible:3},direction:"up",scroll:{items:1,easing:"swing",pauseOnHover:!0,onAfter:function(e){e.items.old.each(function(){t(this).removeClass("visible")}),e.items.visible.each(function(){t(this).addClass("visible")})}},auto:{play:o,timeoutDuration:3e3},prev:{button:"#mp_prev_button"+r},next:{button:"#mp_next_button"+r}}),t(e).trigger("currentVisible",function(t){t.addClass("visible")}),n.setColorSettings(e+" .mptt-colorized")},initDeleteButton:function(){var e=t("#events-list");e.find("li.event").find("i.operation-button.dashicons-no.dashicons").off("click").on("click",function(){e.find("li.event").length>1?t(this).parents("li.event").remove():e.remove()})},initColorPicker:function(e){_.isUndefined(e)&&(e="");var n=t(e+" input.clr-picker"),i=t(e+" input.regular-text");n.spectrum("destroy"),n.spectrum({preferredFormat:"rgb",showInput:!0,showAlpha:!0,allowEmpty:!0,palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#cfe2f3","#d9d2e9","#ead1dc"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],showPalette:!0,show:function(e){t(this).val(e)},hide:function(){var e=t(this).parents(".select-color");e.find(".regular-text").val(t(this).val())},change:function(){var e=t(this).parents(".select-color");e.find('input:not([type="hidden"])').val(t(this).val())}}),i.off("keyup").on("keyup",function(){var e=t(this).parents(".select-color"),n=e.find(".clr-picker"),i=e.find(".regular-text").val(),o=e.find(".sp-preview-inner");o.css({"background-color":i}),n.spectrum("set",i)})},addEventButton:function(){t(document).on("click.admin","#add_mp_event",function(){t(this).hasClass("edit")&&n.updateEventData()})},initDeleteButtons:function(){t(document).on("click.admin","#events-list .delete-event-button",function(){var e=t(this).attr("data-id");n.deleteEvent(e)})},initEditButtons:function(){t(document).on("click.admin","#events-list .edit-event-button",function(){var e=t(this).attr("data-id"),i=t(this).parent().parent();t(this).parent().find(".spinner").addClass("is-active"),Registry._get("adminFunctions").wpAjax({controller:"events",action:"get_event_data",id:e},function(e){var o=t("#add_mp_event"),r=t("#events-list");r.find(".spinner").removeClass("is-active"),r.find(" tr").removeClass("active"),i.addClass("active"),t("#event_start").val(e.event_start),t("#event_end").val(e.event_end),t("#description").val(e.description),t("#user_id").val(e.user_id),t("#weekday_id").val(e.column_id),o.addClass("edit"),o.val("Update"),n.event_id=e.id},function(t){console.warn(t)})})},deleteEvent:function(e){Registry._get("adminFunctions").wpAjax({controller:"events",action:"delete",id:e},function(){var n=t("#events-list").find('tr[data-id="'+e+'"]');n.length&&n.remove()},function(t){console.log(t)})},updateEventItem:function(){var e=t("#events-list").find('tr[data-id="'+n.event_id+'"]'),i=t("#user_id");e.find("td.event-column").text(t("#weekday_id").find("option:selected").text()),e.find("td.event-start").text(t("#event_start").val()),e.find("td.event-end").text(t("#event_end").val()),e.find("td.event-user-id").text("-1"===i.val()?"":i.find("option:selected").text()),e.find("td.event-description").text(t("#description").val()),n.event_id=null,t("#add_mp_event").removeClass("edit").val("Add Time Slot")},updateEventData:function(){var e=t("#add_event_table").find(".spinner");e.addClass("is-active"),Registry._get("adminFunctions").wpAjax({controller:"events",action:"update_event_data",data:{id:Registry._get("Event").event_id,event_start:t("#event_start").val(),event_end:t("#event_end").val(),description:t("#description").val(),user_id:t("#user_id").val(),weekday_ids:t("#weekday_id").val()}},function(){e.removeClass("is-active"),n.updateEventItem(),n.clearTable()},function(t){e.removeClass("is-active"),console.log(t)})},setEventHeight:function(e){var n=e.parent().outerHeight(),i=t("body"),o=e.height(),r=e.data("min-height"),a=e.find(".mptt-inner-event-content").height();e.css("position","").css("width","").css("min-height",""),i.hasClass("mprm_ie")?(a=e.css("height","").find(".mptt-inner-event-content").height(),e.height(o),r>=a?e.css("max-height",r):(e.css("height",""),e.css("max-height",a))):r>=a?e.css("min-height",r):e.css("min-height",a),o>n&&e.height(o)},recalculate_Height:function(e,n){var i=t(".mptt-event-container",e),o=i.length,r=0,a=0,s=e.height();t("body").hasClass("mprm_ie")?(r=s/(o>0?o:1),_.isUndefined(n)?t.each(i,function(){var e=t(this);e.height(r),_.isEmpty(e.data("min-height"))&&e.data("min-height",e.height()),e.css("top",a+"px"),e.removeClass("mptt-hidden"),a+=r}):n.height(r)):(r=100/(o>0?o:1),_.isUndefined(n)?t.each(i,function(){var e=t(this);e.height(r+"%"),_.isEmpty(e.data("min-height"))&&e.data("min-height",e.height()),e.css("top",a+"%"),e.removeClass("mptt-hidden"),a+=r}):n.height(r+"%"))},setEventsHeight:function(){t.each(t(".mptt-shortcode-wrapper table td.event"),function(){var e=t(this);n.recalculate_Height(e)})},setColorSettings:function(e){_.isUndefined(e)&&(e=".mptt-colorized");var i=t(e);t.each(i,function(){var e=t(this),i=e.attr("data-bg_hover_color"),o=e.attr("data-hover_color"),r=e.parent();switch(e.attr("data-type")){case"column":case"event":e.hover(function(){_.isEmpty(i)||e.css("background-color",i),_.isEmpty(o)||e.css("color",o),n.setEventHeight(e)},function(){e.css("max-height","").css("min-height",""),n.recalculate_Height(r,e),e.css("background-color",e.attr("data-bg_color")),e.css("color",e.attr("data-color"))});break;case"widget":e.hover(function(){e.css("background-color",e.attr("data-background-hover-color")),e.css("color",t(this).attr("data-hover-color")),e.css("border-left-color",e.attr("data-hover-border-color"))},function(){e.css("background-color",e.attr("data-background-color")),e.css("color",e.attr("data-color")),e.css("border-left-color",e.attr("data-border-color"))})}})},clearTable:function(){var e=t("#weekday_id");t("#add_event_table input:not(.button),#add_event_table textarea").val(""),e.val(e.find("option:first").attr("value"))},getRowSpan:function(e){var n=[],i=[];t.each(e,function(e){var o=t(this).attr("data-start"),r=t(this).attr("data-end");i[e]=o,n[e]=r});var o=Math.min.apply(Math,i),r=Math.max.apply(Math,n),a=r-o;return 1>a?1:a},responsiveFilter:function(e){var n="all",i=e.parents(".mptt-shortcode-wrapper");n=e.is("select")?e.val():e.attr("href").replace("#","");var o=i.find(".mptt-list-event");"all"!==n?(o.hide(),i.find('.mptt-list-event[data-event-id="'+n+'"]').show()):o.show(),t.each(i.find(".mptt-column"),function(){t(this).show(),t(this).find(".mptt-list-event:visible").length<1&&t(this).hide()})},filterStatic:function(t){var e=t.parents(".mptt-shortcode-wrapper"),i="#all";i=t.is("select")?t.val():t.attr("href").replace("#","");var o=_.isEmpty(e.attr("id"))?"not-set":e.attr("id");window.location.hash=o+":"+i,e.find("table").hide(),e.find('table[id="#'+i+'"]').fadeIn(),n.setEventsHeight()},setClassTd:function(){t.each(t(".mptt-event-container"),function(){t(this).parents("td").addClass("event")})},initTableData:function(){n.setClassTd(),n.setRowSpanTd(),t("."+MPTT.table_class).data("hide_empty_row")&&n.hideEmptyRows()},filterShortcodeEvents:function(){var e=t(".mptt-menu");e.length&&(e.off("change").on("change",function(){n.filterStatic(t(this)),n.responsiveFilter(t(this))}),t(".mptt-navigation-tabs.mptt-menu a").off("click").on("click",function(){var e=t(this);e.parents(".mptt-navigation-tabs.mptt-menu").find("li").removeClass("active"),e.parents("li").addClass("active"),n.filterStatic(e),n.responsiveFilter(e)}))},showCurrentEvent:function(t,e){t.find(".mptt-menu").hasClass("mptt-navigation-tabs")?t.find(".mptt-navigation-tabs").find('a[href="#'+e+'"]').click():t.find(".mptt-menu").hasClass("mptt-navigation-select")&&t.find('.mptt-navigation-select option[value="'+e+'"]')?t.find(".mptt-navigation-select").val(e).change():t.find('table[id="#all"]').fadeIn()},getFilterByHash:function(){var e=1,i=window.location.hash;if(!_.isUndefined(i)){var o=i.split(":"),r=o[0],a=o[1],s=t(".mptt-shortcode-wrapper");a=_.isUndefined(a)?"all":a,s.length===e?n.showCurrentEvent(s,a):t.each(s,function(e,i){var o=t(i),s="#"+o.attr("id");s===r?n.showCurrentEvent(o,a):n.showCurrentEvent(o,"all")})}n.setEventsHeight()},removeCellsAfterChangeColSpan:function(t,e,n,i){for(t;e>t;t++){var o=n.find('th[data-index="'+t+'"]').data("column-id");i.find('td:not(.event)[data-column-id="'+o+'"]').remove()}},removeCellsAfterChangeRowSpan:function(t,e,i,o){var r=t.parents("tr").attr("data-index"),a=e+parseInt(r)-1,s=t.attr("colspan"),c=i.find('th[data-column-id="'+o+'"]').data("index"),d=parseInt(c)+parseInt(s);for(r;a>r;r++){var l=i.find("tr.mptt-shortcode-row-"+(parseInt(r)+1));if(l.length){if(l.find('td.event[data-column-id="'+o+'"]').length&&(e-=a-r,2>e)){e=1;break}s>1&&n.removeCellsAfterChangeColSpan(c,d,i,l),l.find('td:not(.event)[data-column-id="'+o+'"]').remove()}}return e},setRowSpanTd:function(){t.each(t("."+MPTT.table_class),function(){var e=t(this);t.each(e.find("td.event"),function(){var i=t(this),o=i.find(".mptt-event-container"),r=i.attr("data-column-id"),a=i.attr("data-row_height"),s=n.getRowSpan(o);!_.isUndefined(s)&&s>1&&(s=n.removeCellsAfterChangeRowSpan(i,s,e,r),isNaN(a)||i.css("height",s*a)),i.attr("rowspan",s)})})},hideEmptyRows:function(){var e=t("."+MPTT.table_class+" tbody tr"),n=t("."+MPTT.table_class).first().find("th").length;t.each(e,function(e,i){0===t(i).find("td.event").length&&t(i).find("td").length===n&&t(i).remove()})},displaySettings:function(){var e=t(".view_settings");e.length&&e.change(function(){if("all"===t(this).val()){t(this).attr("id");t(this).parents(".mptt-container").find(".next-days").css("display","block")}else t(this).parents(".mptt-container").find(".next-days").css("display","none")})},timeMode:function(e){e&&t("#"+e).change(function(){if("server"===t(this).val()){t(this).attr("id");t(this).parents(".mptt-container").find("."+t(this).attr("id")).css("display","block")}else t(this).parents(".mptt-container").find("."+t(this).attr("id")).css("display","none")})},initDatePicker:function(){var e=t("#datepicker");e.length&&e.datepicker({dateFormat:"d/m/yy",setDate:Date.parse(e.val())})},columnRadioBox:function(){var e=t("#datepicker"),n=t('input.option-input[name="column[column_option]"]'),i=t("select.mp-weekday");n.length&&n.on("change",function(){switch(t(this).val()){case"simple":i.prop("disabled",!0),e.prop("disabled",!0);break;case"weekday":i.prop("disabled",!1),e.val("").prop("disabled",!0);break;case"date":i.prop("disabled",!0),e.prop("disabled",!1)}})}}}var n;return{getInstance:function(){return n||(n=e()),n}}}(jQuery));
